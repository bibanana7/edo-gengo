<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>元号一覧</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="江戸時代からの元号の一覧です。" />
    <link rel="icon" href="favicon.ico" />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div id="app">
      <h1>元号一覧</h1>
      <div class="buttons">
        <button @click="sortByYomi">
          <span
            >読み仮名で並び替え（{{ sortOrder === 'asc' ? 'あ→ん' : 'ん→あ'
            }}）</span
          >
        </button>
        <button @click="resetToOriginalOrder"><span>年号順に戻す</span></button>
      </div>
      <p>干支はクリックで展開します。</p>
      <table>
        <thead>
          <tr>
            <th>元号</th>
            <th>開始年</th>
            <th>干支</th>
          </tr>
        </thead>
        <tbody>
          <template
            v-for="(era, index) in eraList"
            :key="era.name + '-' + index"
          >
            <tr>
              <td>
                <ruby
                  >{{ era.name }}<rp>(</rp><rt>{{ era.yomi }}</rt
                  ><rp>)</rp></ruby
                >
              </td>
              <td>{{ era.startYear }}年〜</td>
              <td role="button" @click="toggleEto(era.name)">
                <ruby
                  >{{ era.startEto }}<rp>(</rp><rt>{{ era.Etoyomi }}</rt
                  ><rp>)</rp></ruby
                >
              </td>
            </tr>

            <!-- 干支年表示 -->
            <tr v-if="expandedEra === era.name" class="expand">
              <td :colspan="3">
                <ul class="eto-list">
                  <li v-for="yearData in getEtoYears(era)" :key="yearData.year">
                    {{ era.name }}{{ yearData.gengouYear === 1 ? '元' :
                    yearData.gengouYear }}年 （西暦{{ yearData.year }}年）：
                    <ruby>
                      {{ yearData.etoName }}<rp>(</rp
                      ><rt>{{ yearData.etoYomi }}</rt><rp>)</rp>
                    </ruby>
                  </li>
                </ul>
              </td>
            </tr>
          </template>
        </tbody>
      </table>

      <button @click="goToList"><span>元号比較ツールへジャンプ</span></button>
    </div>
    <script src="script.js"></script>
    <!-- <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script> -->
    <!-- 本番用 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script>
      Vue.createApp({
        data() {
          return {
            eraList: [...eraList],
            originalEraList: [...eraList],
            sortOrder: "asc",
            expandedEra: null,
          };
        },
        methods: {
          toggleEto(name) {
            this.expandedEra = this.expandedEra === name ? null : name;
          },
          getEtoYears(era) {
            const result = [];
            const startIndex = etoList.findIndex(
              (e) => e.name === era.startEto
            );
            if (startIndex === -1) return result;
            for (
              let year = era.startYear;
              year <= (era.endYear || era.startYear);
              year++
            ) {
              const idx = (startIndex + (year - era.startYear)) % 60;
              const etoObj = etoList[idx];
              result.push({
                year, // 西暦
                gengouYear: year - era.startYear + 1, // 元年〜n年
                etoName: etoObj.name,
                etoYomi: etoObj.Etoyomi,
              });
            }
            return result;
          },
          sortByYomi() {
            if (this.sortOrder === "asc") {
              this.eraList.sort((a, b) => a.yomi.localeCompare(b.yomi, "ja"));
              this.sortOrder = "desc";
            } else {
              this.eraList.sort((a, b) => b.yomi.localeCompare(a.yomi, "ja"));
              this.sortOrder = "asc";
            }
          },
          resetToOriginalOrder() {
            this.eraList = [...this.originalEraList];
            this.sortOrder = "asc";
          },
          goToList() {
            window.location.href = "index.html";
          },
        },
      }).mount("#app");

      // 最初の要素の分割代入
      const era = window.eraList[0];
      const { startYear, endYear, startEto } = era;
    </script>
  </body>
</html>
